/** ======= Background login ======= **/
$("#login").click(function() {
	var username = $.trim($("#username").val());
	var password = $.trim($("#password").val());
	if(username == "" || password == "") {
		return alert("每一项都不可以为空!");
	} else {
		$.post("index.php", {"mod": "admin", "action": "login", "username": username, "password": password}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				alert("登录成功");
				return history.go(0);
			}
			return alert("账号或密码不正确!");
		});
	}
});

/** ======= Conversion JSON ======= **/
function strToJson(str){ 
	var json = eval('(' + str + ')'); 
	return json;
}

/** ======= Change background image ======= **/
function setBackGroUnd(id) {
	var num = Math.floor(Math.random() * 5);
	return $("#" + id).css("backgroundImage","url(//api.speblog.ga/image/bj-" + num + ".jpg)");
}

/** ======= Modify system information ======= **/
$("#setSystem").click(function(){
	var sitename = $.trim($("#sitename").val());
	var keywords = $.trim($("#keywords").val());
	var description = $.trim($("#description").val());
	$.post("index.php", {"mod": "admin", "action": "setSystem", "sitename": sitename, "keywords": keywords, "description": description}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!");
	});
});

/** ======= Modify Menu ======= **/
$("#setMenu").click(function(){
	var menuhtm = $.trim($("#menu_htm").val());
	$.post("index.php", {"mod": "admin", "action": "setMenu", "menuhtm": menuhtm}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!(没做任何改动也会修改失败!)");
	});
});

/** ======= Modify Links ======= **/
$("#setLinks").click(function(){
	var linkshtm = $.trim($("#links_htm").val());
	$.post("index.php", {"mod": "admin", "action": "setLinks", "linkshtm": linkshtm}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!(没做任何改动也会修改失败!)");
	});
});

/** ======= Modify Css ======= **/
$("#setCss").click(function(){
	var css = $("#css_txt").val();
	$.post("index.php", {"mod":"admin", "action": "setCss", "css": css}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!(没做任何改动也会修改失败!)");
	});
});

/** ======= Modify Data ======= **/
$("#setData").click(function(){
	var username = $.trim($("#username").val());
	if(username.length > 16) {
		return alert("用户名长度超出!");
	} else if(username != "") {
		$.post("index.php", {"mod": "admin", "action": "setData", "username": username}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				$("#admin_menu #admin_li b").html("");
				$("#admin_menu #admin_li b").html('<i class="fa fa-user-secret"></i> ' + username);
				return alert("修改成功(后台需要用户名登录，请牢记修改后的用户名!)");
			}
			return alert("修改失败!");
		});
	} else {
		return alert("用户名不可为空!");
	}
});

/** ======= Modify PassWord ======= **/
$("#setPassWord").click(function(){
	var pass1 = $.trim($("#password1").val());
	var pass2 = $.trim($("#password2").val());
	var pass3 = $.trim($("#password3").val());
	if(pass1 == "" || pass2 == "" || pass3 == "") {
		return alert("每一项都不可为空!");
	} else if (pass2 != pass3) {
		return alert("两次输入的密码不一致!");
	} else {
		$.post("index.php", {"mod": "admin", "action": "setPassWord", "pass1": pass1, "pass2": pass2}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				return alert("密码修改成功，下次登录前生效!");
			} else if(result.code == 2) {
				return alert("旧密码不正确!");
			} else {
				return alert("密码修改失败!");
			}
		});
	}
});

/** ======= Admin Exit ======= **/
function logout() {
	var ok = confirm("确认注销登录?");
	if(ok) {
		$.post("index.php", {"mod": "admin", "action": "logout"}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				alert("注销成功!");
				return history.go(0);
			}
			return alert("注销失败!");
		});
	}
}

/** ======= Add Article ======= **/
$("#addArticle").click(function(){
	var articles_title = $("#articles_title").val();
	var articles_html = editor.$txt.html();
	if(articles_title == "") {
		return alert("请输入文章标题!");
	} else if (articles_title.length > 30) {
		return alert("标题长度超出!");
	}
	$.post("index.php", {"mod": "admin", "action": "addArticle", "articles_title": articles_title, "articles_html": articles_html}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			alert("发布成功!");
			return history.go(0);
		}
		return alert("发布失败!");
	});
});

/** ======= Edit Article ======= **/
function editArticle(id) {
	$.post("index.php", {"mod": "admin", "action": "editArticle", "id": id}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			var title = result.data.title;
			var box = result.data.box;
			$("#editArticles_title").val(title);
			editor.$txt.html('<p><br></p>');
			editor.$txt.html(box);
		}
	});
}

/** ======= Delete Article ======= **/
function delArticle(id) {
	var del = confirm("确认删除ID为 "+ id +" 的文章?");
	if(del) {
		$.post("index.php", {"mod": "admin", "action": "delArticle", "id": id}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				$("#blog-word-" + id).remove();
				return alert("删除成功!");
			}
			return alert("删除失败!");
		});
	}
}