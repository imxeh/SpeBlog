/** ======= Background login ======= **/
$("#login").click(function() {
	var username = $.trim($("#username").val());
	var password = $.trim($("#password").val());
	if(username == "" || password == "") {
		return alert("每一项都不可以为空!");
	} else {
		$.post("index.php", {"mod": "admin", "action": "login", "username": username, "password": password}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				alert("登录成功");
				return history.go(0);
			}
			return alert("账号或密码不正确!");
		});
	}
});

/** ======= Conversion JSON ======= **/
function strToJson(str){ 
	var json = eval('(' + str + ')'); 
	return json;
}

/** ======= Change background image ======= **/
function setBackGroUnd(id) {
	var num = Math.floor(Math.random() * 5);
	return $("#" + id).css("backgroundImage","url(//api.speblog.ga/image/bj-" + num + ".jpg)");
}

/** ======= Modify system information ======= **/
$("#setSystem").click(function(){
	var sitename = $.trim($("#sitename").val());
	var keywords = $.trim($("#keywords").val());
	var description = $.trim($("#description").val());
	$.post("index.php", {"mod": "admin", "action": "setSystem", "sitename": sitename, "keywords": keywords, "description": description}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!");
	});
});

/** ======= Modify Menu ======= **/
$("#setMenu").click(function(){
	var menuhtm = $.trim($("#menu_htm").val());
	$.post("index.php", {"mod": "admin", "action": "setMenu", "menuhtm": menuhtm}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!(没做任何改动也会修改失败!)");
	});
});

/** ======= Modify Links ======= **/
$("#setLinks").click(function(){
	var linkshtm = $.trim($("#links_htm").val());
	$.post("index.php", {"mod": "admin", "action": "setLinks", "linkshtm": linkshtm}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!(没做任何改动也会修改失败!)");
	});
});

/** ======= Modify Css ======= **/
$("#setCss").click(function(){
	var css = $("#css_txt").val();
	$.post("index.php", {"mod":"admin", "action": "setCss", "css": css}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			return alert("修改成功");
		}
		return alert("修改失败!(没做任何改动也会修改失败!)");
	});
});

/** ======= Modify Data ======= **/
$("#setData").click(function(){
	var username = $.trim($("#username").val());
	if(username.length > 16) {
		return alert("用户名长度超出!");
	} else if(username != "") {
		$.post("index.php", {"mod": "admin", "action": "setData", "username": username}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				$("#admin_menu #admin_li b").html("");
				$("#admin_menu #admin_li b").html('<i class="fa fa-user-secret"></i> ' + username);
				return alert("修改成功(后台需要用户名登录，请牢记修改后的用户名!)");
			}
			return alert("修改失败!");
		});
	} else {
		return alert("用户名不可为空!");
	}
});

/** ======= Modify PassWord ======= **/
$("#setPassWord").click(function(){
	var pass1 = $.trim($("#password1").val());
	var pass2 = $.trim($("#password2").val());
	var pass3 = $.trim($("#password3").val());
	if(pass1 == "" || pass2 == "" || pass3 == "") {
		return alert("每一项都不可为空!");
	} else if (pass2 != pass3) {
		return alert("两次输入的密码不一致!");
	} else {
		$.post("index.php", {"mod": "admin", "action": "setPassWord", "pass1": pass1, "pass2": pass2}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				return alert("密码修改成功，下次登录前生效!");
			} else if(result.code == 2) {
				return alert("旧密码不正确!");
			} else {
				return alert("密码修改失败!");
			}
		});
	}
});

/** ======= Admin Exit ======= **/
function logout() {
	var ok = confirm("确认注销登录?");
	if(ok) {
		$.post("index.php", {"mod": "admin", "action": "logout"}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				alert("注销成功!");
				return history.go(0);
			}
			return alert("注销失败!");
		});
	}
}

/** ======= Add Article ======= **/
$("#addArticle").click(function(){
	var articles_title = $("#articles_title").val();
	var articles_html = editor.$txt.html();
	if(articles_title == "") {
		return alert("请输入文章标题!");
	} else if (articles_title.length > 30) {
		return alert("标题长度超出!");
	}
	$.post("index.php", {"mod": "admin", "action": "addArticle", "articles_title": articles_title, "articles_html": articles_html}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			alert("发布成功!");
			return history.go(0);
		}
		return alert("发布失败!");
	});
});

/** ======= Edit Article ======= **/
function editArticle(id) {
	$.post("index.php", {"mod": "admin", "action": "editArticle", "id": id}, function(result){
		result = strToJson(result);
		if(result.code == 1) {
			var title = result.data.title;
			var box = result.data.box;
			$("#editArticles_title").val(title);
			editor.$txt.html('<p><br></p>');
			editor.$txt.html(box);
			$("#editArticles").click(function(){
				$.post("index.php", {"mod": "admin", "action": "editArticles", "id": id, "article_title": $.trim($("#editArticles_title").val()), "article_box": editor.$txt.html()}, function(result){
					result = strToJson(result);
					if(result.code == 1) {
						alert("更改成功!");
						return history.go(0);
					}
					return alert("更改失败!");
				});
			});
		}
	});
}

/** ======= Delete Article ======= **/
function delArticle(id) {
	var del = confirm("确认删除ID为 "+ id +" 的文章?(删除无法恢复!)");
	if(del) {
		$.post("index.php", {"mod": "admin", "action": "delArticle", "id": id}, function(result){
			result = strToJson(result);
			if(result.code == 1) {
				$("#blog-word-" + id).remove();
				return alert("删除成功!");
			}
			return alert("删除失败!");
		});
	}
}

/** ======= Get Update ======= **/
function getUpdate(v) {
	$("#getUpdate").button('loading');
	if(v != "") {
		$.ajax({
		     url: "index.php",
		     type: "POST",
		     data: {"mod":"admin", "action": "systemUpdate", "v": v},
		     dataType: "JSON",
		     //crossDomain: true,
		     success: function(result){
		    	//result = strToJson(result);
		    	if(result.NewestVersion > v) {
					$("#update").html("");
					$("#update").html("发现新版本! v"+ result.NewestVersion +" 下载地址：<a target='_blank' href="+ result.DownloadUrl +">点击下载<a>");
					return $("#getUpdate").button('reset');
				} else if (result.NewestVersion == v) {
					$("#getUpdate").button('reset');
					return $("#update").html('暂无更新');
				} else {
					$("#getUpdate").button('reset');
					return $("#update").html('更新程序异常');
				}
		     },
		     error: function(){
		    	 $("#getUpdate").button('reset');
		    	 return alert("与更新服务端通信异常!");
		     }
		});
	}
}

/** ======= Jquery Go Up ======= **/
$(document).ready(function () {
    $.goup({
        trigger: 100,
        bottomOffset: 20,
        locationOffset: 20,
        containerColor: "#428BCA",
        //title: 'Top',
        titleAsText: true
    });

});

/*
 *
 * Copyright (c) 2014 Daniele Lenares (https://github.com/Ryuk87)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * 
 * Version 0.5.1
 *
 */
(function(e){function t(e,t,n){if(t=="show"){switch(n){case"fade":e.fadeIn();break;case"slide":e.slideDown();break;default:e.fadeIn()}}else{switch(n){case"fade":e.fadeOut();break;case"slide":e.slideUp();break;default:e.fadeOut()}}}e.goup=function(n){var r=e.extend({location:"right",locationOffset:20,bottomOffset:10,containerRadius:10,containerClass:"goup-container",arrowClass:"goup-arrow",alwaysVisible:false,trigger:500,entryAnimation:"fade",goupSpeed:"slow",hideUnderWidth:500,containerColor:"#000",arrowColor:"#fff",title:"",titleAsText:false,titleAsTextClass:"goup-text"},n);e("body").append('<div style="display:none" class="'+r.containerClass+'"></div>');var i=e("."+r.containerClass);e(i).html('<div class="'+r.arrowClass+'"></div>');var s=e("."+r.arrowClass);var o=r.location;if(o!="right"&&o!="left"){o="right"}var u=r.locationOffset;if(u<0){u=0}var a=r.bottomOffset;if(a<0){a=0}var f=r.containerRadius;if(f<0){f=0}var l=r.trigger;if(l<0){l=0}var c=r.hideUnderWidth;if(c<0){c=0}var h=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;if(h.test(r.containerColor)){var p=r.containerColor}else{var p="#000"}if(h.test(r.arrowColor)){var d=r.arrowColor}else{var d="#fff"}if(r.title===""){r.titleAsText=false}var v={};v={position:"fixed",width:40,height:40,background:p,cursor:"pointer"};v["bottom"]=a;v[o]=u;v["border-radius"]=f;e(i).css(v);if(!r.titleAsText){e(i).attr("title",r.title)}else{e("body").append('<div class="'+r.titleAsTextClass+'">'+r.title+"</div>");var m=e("."+r.titleAsTextClass);e(m).attr("style",e(i).attr("style"));e(m).css("background","transparent").css("width",80).css("height","auto").css("text-align","center").css(o,u-20);var g=e(m).height()+10;e(i).css("bottom","+="+g+"px")}var y={};y={width:0,height:0,margin:"0 auto","padding-top":13,"border-style":"solid","border-width":"0 10px 10px 10px","border-color":"transparent transparent "+d+" transparent"};e(s).css(y);var b=false;e(window).resize(function(){if(e(window).outerWidth()<=c){b=true;t(e(i),"hide",r.entryAnimation);if(m)t(e(m),"hide",r.entryAnimation)}else{b=false;e(window).trigger("scroll")}});if(e(window).outerWidth()<=c){b=true;e(i).hide();if(m)e(m).hide()}if(!r.alwaysVisible){e(window).scroll(function(){if(e(window).scrollTop()>=l&&!b){t(e(i),"show",r.entryAnimation);if(m)t(e(m),"show",r.entryAnimation)}if(e(window).scrollTop()<l&&!b){t(e(i),"hide",r.entryAnimation);if(m)t(e(m),"hide",r.entryAnimation)}})}else{t(e(i),"show",r.entryAnimation);if(m)t(e(m),"show",r.entryAnimation)}if(e(window).scrollTop()>=l&&!b){t(e(i),"show",r.entryAnimation);if(m)t(e(m),"show",r.entryAnimation)}e(i).on("click",function(){e("html,body").animate({scrollTop:0},r.goupSpeed);return false});e(m).on("click",function(){e("html,body").animate({scrollTop:0},r.goupSpeed);return false})}})(jQuery)